<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap"
      rel="stylesheet"
    />
    <title>Danke!</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100dvh;
        margin: 0;
        background: #0a0c10;
        color: #fff;
        font-family: "Fredoka", sans-serif;
        text-align: center;
        overflow: hidden;
      }
      .thanks {
        max-width: 420px;
        position: relative;
        z-index: 2;
      }
      h1 {
        font-size: 2rem;
        margin-bottom: 1rem;
      }
      p {
        color: #cfd6e6;
        margin-bottom: 2rem;
      }
      .close-btn {
        appearance: none;
        border: 0;
        background: linear-gradient(180deg, #3a3a3a, #1e1e1e);
        color: #fff;
        font-weight: 700;
        padding: 12px 20px;
        border-radius: 999px;
        cursor: pointer;
        font-size: 1rem;
        transition: transform 0.15s ease;
        position: relative;
        z-index: 3;
      }
      .close-btn:active {
        transform: scale(0.96);
      }
      canvas {
        position: fixed;
        inset: 0;
        z-index: 1;
        pointer-events: none;
      }
      canvas#confetti {
        position: fixed;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh; /* wichtig! */
        z-index: 1;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <canvas id="confetti"></canvas>
    <div class="thanks">
      <h1>ðŸŽ‰ Vielen Dank fÃ¼rs Spielen!</h1>
      <p>Ein Hoch auf das Brautpaar ðŸ¥‚</p>
    </div>

    <script>
      const prefersReduced =
        window.matchMedia &&
        window.matchMedia("(prefers-reduced-motion: reduce)").matches;

      const canvas = document.getElementById("confetti");
      const ctx = canvas.getContext("2d", { alpha: true });

      let DPR = 1,
        Wcss = 0,
        Hcss = 0,
        SCALE = 1;

      function fit() {
        // CSS-GrÃ¶ÃŸe (Viewport)
        Wcss = Math.max(1, Math.round(window.innerWidth));
        Hcss = Math.max(1, Math.round(window.innerHeight));

        // Device Pixel Ratio
        DPR = Math.max(1, window.devicePixelRatio || 1);

        // Canvas-PixelgrÃ¶ÃŸe
        canvas.width = Math.floor(Wcss * DPR);
        canvas.height = Math.floor(Hcss * DPR);

        // Wir zeichnen direkt in Canvas-Pixeln (kein setTransform)
        SCALE = Math.min(Wcss, Hcss) / 800;
        SCALE = Math.max(0.5, Math.min(1.0, SCALE)); // clamp
      }
      window.addEventListener("resize", fit, { passive: true });
      fit();

      const COLORS = ["#b75cff", "#8a53ff", "#18e0b8", "#2aa5ff", "#ffd166"];
      let parts = [];

      function spawnConfettiCanvasPx(xPx, yPx, count = 120) {
        if (prefersReduced) return;

        const speedBase = 180 * SCALE * DPR;
        const speedVar = 220 * SCALE * DPR;
        const upKick = 110 * SCALE * DPR;

        for (let i = 0; i < count; i++) {
          const ang = Math.random() * Math.PI * 2;
          const speed = speedBase + Math.random() * speedVar;
          parts.push({
            x: xPx,
            y: yPx,
            vx: Math.cos(ang) * speed,
            vy: Math.sin(ang) * speed - upKick,
            size: (2.5 + Math.random() * 4.5) * SCALE * DPR,
            rot: Math.random() * Math.PI * 2,
            vr: (Math.random() - 0.5) * (10 * SCALE), // rot in rad/s, nicht DPR-abhÃ¤ngig
            col: COLORS[(Math.random() * COLORS.length) | 0],
            life: 0.6 + Math.random() * 0.6, // s
            born: performance.now(),
          });
        }
      }

      function tick(now) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const g = 1100 * SCALE * DPR; // px/s^2 in Canvas-Pixeln
        const dt = 1 / 60;

        parts = parts.filter((p) => {
          p.vy += g * dt;
          p.x += p.vx * dt;
          p.y += p.vy * dt;
          p.rot += p.vr * dt;

          const age = (now - p.born) / 1000;
          const alpha = 1 - Math.max(0, (age - p.life) / p.life);
          if (alpha <= 0) return false;

          ctx.save();
          ctx.globalAlpha = alpha;
          ctx.translate(p.x, p.y);
          ctx.rotate(p.rot);
          ctx.fillStyle = p.col;
          ctx.fillRect(-p.size, -p.size * 0.4, p.size * 2, p.size * 0.8);
          ctx.restore();
          return true;
        });

        requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);

      // Hilfsfunktion: Event (clientX/Y) â†’ Canvas-Pixel exakt
      function eventToCanvasPx(e) {
        const rect = canvas.getBoundingClientRect(); // CSS-Pixel
        const vvX = window.visualViewport?.offsetLeft || 0;
        const vvY = window.visualViewport?.offsetTop || 0;

        // Skalen von CSS-Px â†’ Canvas-Px
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;

        // Position relativ zur Canvas-Box + VisualViewport-Korrektur
        const xPx = (e.clientX + vvX - rect.left) * scaleX;
        const yPx = (e.clientY + vvY - rect.top) * scaleY;

        return { xPx, yPx };
      }

      // 20 Auto-Explosionen rund um die Mitte (mittig variieren)
      (function runAutoExplosions() {
        if (prefersReduced) return;
        let n = 0,
          max = 20;
        const loop = () => {
          if (n++ >= max) return;
          const rect = canvas.getBoundingClientRect();
          const centerX = rect.width / 2;
          const centerY = rect.height / 2;
          const jitterX = (Math.random() - 0.5) * (rect.width * 0.35);
          const jitterY = (Math.random() - 0.5) * (rect.height * 0.28);

          // CSS â†’ Canvas-Pixel
          const scaleX = canvas.width / rect.width;
          const scaleY = canvas.height / rect.height;
          const xPx = (centerX + jitterX) * scaleX;
          const yPx = (centerY + jitterY) * scaleY;

          spawnConfettiCanvasPx(xPx, yPx, 110);
          setTimeout(loop, 500);
        };
        loop();
      })();

      // User-Tap/Klick â†’ punktgenau
      window.addEventListener(
        "pointerdown",
        (e) => {
          const { xPx, yPx } = eventToCanvasPx(e);
          spawnConfettiCanvasPx(xPx, yPx, 150);
        },
        { passive: true }
      );
    </script>
  </body>
</html>
